<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>揪團點餐助手</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        :root { --line-green: #06C755; --bg-gray: #f4f4f7; }
        body { font-family: -apple-system, system-ui, sans-serif; background-color: var(--bg-gray); margin: 0; padding: 20px; }
        .card { background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        h2 { margin-top: 0; color: var(--line-green); text-align: center; }
        .section { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #666; font-size: 0.9rem; }
        select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; background: #fff; }
        .radio-group { display: flex; gap: 10px; }
        .radio-group label { flex: 1; display: flex; align-items: center; justify-content: center; background: #fff; border: 1px solid #ddd; padding: 10px; border-radius: 8px; cursor: pointer; }
        .radio-group input { display: none; }
        .radio-group input:checked + span { color: var(--line-green); font-weight: bold; }
        .radio-group label:has(input:checked) { border-color: var(--line-green); background: #f0fff4; }
        button { width: 100%; padding: 16px; background: var(--line-green); color: white; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: bold; margin-top: 10px; }
        #status { text-align: center; color: #999; font-size: 0.8rem; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="card">
        <h2 id="storeName">讀取中...</h2>
        
        <div class="section">
            <label>品項</label>
            <select id="item">
                <option>珍珠奶茶</option><option>四季春茶</option><option>紅茶拿鐵</option><option>燕麥拿鐵</option>
            </select>
        </div>

        <div class="section">
            <label>容量</label>
            <div class="radio-group">
                <label><input type="radio" name="size" value="大" checked> <span>大杯</span></label>
                <label><input type="radio" name="size" value="中"> <span>中杯</span></label>
            </div>
        </div>

        <div class="section" style="display: flex; gap: 10px;">
            <div style="flex: 1;">
                <label>冰塊</label>
                <select id="ice">
                    <option>去冰</option><option>微冰</option><option>少冰</option><option>正常冰</option>
                </select>
            </div>
            <div style="flex: 1;">
                <label>甜度</label>
                <select id="sugar">
                    <option>無糖</option><option>微糖</option><option>半糖</option><option>正常糖</option>
                </select>
            </div>
        </div>

        <div class="section">
            <label>這杯誰喝？</label>
            <div class="radio-group">
                <label><input type="radio" name="type" value="自己點" checked> <span>我自己</span></label>
                <label><input type="radio" name="type" value="代點"> <span>幫人點</span></label>
            </div>
        </div>

        <button onclick="sendOrder()">確認點餐</button>
        <div id="status">LIFF 初始化中...</div>
    </div>

    <script>
        const myLiffId = "2008930067-ncNoJlEK";

        // 1. 初始化 LIFF
        liff.init({ liffId: myLiffId })
            .then(() => {
                document.getElementById('status').innerText = "LIFF 已就緒";
                if (!liff.isLoggedIn()) {
                    liff.login();
                }
                const urlParams = new URLSearchParams(window.location.search);
                const store = urlParams.get('store');
                if (store) document.getElementById('storeName').innerText = store;
            })
            .catch((err) => {
                document.getElementById('status').innerText = "初始化失敗";
                alert("LIFF 初始化錯誤: " + err);
            });

        // 2. 傳送訂單
        function sendOrder() {
            const store = document.getElementById('storeName').innerText;
            const item = document.getElementById('item').value;
            const size = document.querySelector('input[name="size"]:checked').value;
            const ice = document.getElementById('ice').value;
            const sugar = document.getElementById('sugar').value;
            const type = document.querySelector('input[name="type"]:checked').value;

            const orderMsg = `#點餐 ${store}/${item}/${size}/${ice}/${sugar}/${type}`;

            // 檢查是否有權限傳送訊息
            if (!liff.isInClient()) {
                alert("請在 LINE App 內開啟此網頁");
                return;
            }

            liff.sendMessages([{
                type: 'text',
                text: orderMsg
            }]).then(() => {
                // 成功送出後關閉視窗
                liff.closeWindow();
            }).catch((err) => {
                // 如果失敗，彈出具體錯誤原因
                alert("傳送失敗！錯誤代碼：" + err.code + "\n訊息：" + err.message + "\n請檢查 Scopes 是否有勾選 chat_message.write");
            });
        }
    </script>
</body>
</html>
